# Next.js Static Export .htaccess for Hostinger (Apache/LiteSpeed)
# Enforces trailing slashes for directories but EXCLUDES static assets.

RewriteEngine On
RewriteBase /

# 1. DISABLE CACHING FOR .htaccess ITSELF (Helps during troubleshooting)
<Files ".htaccess">
    Header set Cache-Control "max-age=0, no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "Wed, 11 Jan 1984 05:00:00 GMT"
</Files>

# 2. OPTIMIZE ASSET CACHING
# This helps the CDN and browser know how to handle your static chunks.
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresDefault "access plus 1 month"
    # Don't cache HTML (so updates to pages are seen immediately)
    ExpiresByType text/html "access plus 0 seconds"
    # Cache CSS/JS/Images (since they are hashed by Next.js)
    ExpiresByType text/css "access plus 1 year"
    ExpiresByType application/javascript "access plus 1 year"
    ExpiresByType image/x-icon "access plus 1 year"
</IfModule>

# 3. EXCLUDE: Don't apply redirection to existing files
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# 4. EXCLUDE: Don't add slashes to files that look like they have extensions
# (Prevents .css/, .js/, etc. from being created by the redirect rule)
RewriteCond %{REQUEST_URI} \.(css|js|png|jpg|jpeg|gif|ico|svg|webp|woff|woff2|ttf|otf|json|xml|txt|pdf)$ [NC]
RewriteRule ^ - [L]

# 5. EXCLUDE: System directories
RewriteRule ^_next/ - [L]

# 6. FORCE TRAILING SLASH for Directories/Clean URLs
# Only applies if it's NOT a file and NOT already slashed.
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_URI} !(.*)/$
RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1/ [R=301,L]

# 7. HANDLE DIRECTORY INDEXES
RewriteCond %{REQUEST_FILENAME} -d
RewriteCond %{REQUEST_FILENAME}/index.html -f
RewriteRule ^(.*)$ $1/index.html [L]

# 8. Fallback for clean URLs (insurance)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME}.html -f
RewriteRule ^(.*)$ $1.html [L]

# 9. CUSTOM 404
ErrorDocument 404 /404/index.html
