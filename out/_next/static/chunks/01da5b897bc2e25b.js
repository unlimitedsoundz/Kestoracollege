(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,27269,e=>{"use strict";var t=e.i(71645);let a=new Map([["bold",t.createElement(t.Fragment,null,t.createElement("path",{d:"M236,128a108,108,0,0,1-216,0c0-42.52,24.73-81.34,63-98.9A12,12,0,1,1,93,50.91C63.24,64.57,44,94.83,44,128a84,84,0,0,0,168,0c0-33.17-19.24-63.43-49-77.09A12,12,0,1,1,173,29.1C211.27,46.66,236,85.48,236,128Z"}))],["duotone",t.createElement(t.Fragment,null,t.createElement("path",{d:"M224,128a96,96,0,1,1-96-96A96,96,0,0,1,224,128Z",opacity:"0.2"}),t.createElement("path",{d:"M232,128a104,104,0,0,1-208,0c0-41,23.81-78.36,60.66-95.27a8,8,0,0,1,6.68,14.54C60.15,61.59,40,93.27,40,128a88,88,0,0,0,176,0c0-34.73-20.15-66.41-51.34-80.73a8,8,0,0,1,6.68-14.54C208.19,49.64,232,87,232,128Z"}))],["fill",t.createElement(t.Fragment,null,t.createElement("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,176A72,72,0,0,1,92,65.64a8,8,0,0,1,8,13.85,56,56,0,1,0,56,0,8,8,0,0,1,8-13.85A72,72,0,0,1,128,200Z"}))],["light",t.createElement(t.Fragment,null,t.createElement("path",{d:"M230,128a102,102,0,0,1-204,0c0-40.18,23.35-76.86,59.5-93.45a6,6,0,0,1,5,10.9C58.61,60.09,38,92.49,38,128a90,90,0,0,0,180,0c0-35.51-20.61-67.91-52.5-82.55a6,6,0,0,1,5-10.9C206.65,51.14,230,87.82,230,128Z"}))],["regular",t.createElement(t.Fragment,null,t.createElement("path",{d:"M232,128a104,104,0,0,1-208,0c0-41,23.81-78.36,60.66-95.27a8,8,0,0,1,6.68,14.54C60.15,61.59,40,93.27,40,128a88,88,0,0,0,176,0c0-34.73-20.15-66.41-51.34-80.73a8,8,0,0,1,6.68-14.54C208.19,49.64,232,87,232,128Z"}))],["thin",t.createElement(t.Fragment,null,t.createElement("path",{d:"M228,128a100,100,0,0,1-200,0c0-39.4,22.9-75.37,58.33-91.63a4,4,0,1,1,3.34,7.27C57.07,58.6,36,91.71,36,128a92,92,0,0,0,184,0c0-36.29-21.07-69.4-53.67-84.36a4,4,0,1,1,3.34-7.27C205.1,52.63,228,88.6,228,128Z"}))]]);e.s(["default",()=>a])},58697,e=>{"use strict";function t(e){if(!e)return"-";let t=new Date(e);if(isNaN(t.getTime()))return"-";let a=String(t.getDate()).padStart(2,"0"),n=String(t.getMonth()+1).padStart(2,"0"),r=t.getFullYear();return`${a}/${n}/${r}`}e.s(["formatToDDMMYYYY",()=>t])},73987,e=>{"use strict";var t=e.i(71645);let a=new Map([["bold",t.createElement(t.Fragment,null,t.createElement("path",{d:"M168.49,199.51a12,12,0,0,1-17,17l-80-80a12,12,0,0,1,0-17l80-80a12,12,0,0,1,17,17L97,128Z"}))],["duotone",t.createElement(t.Fragment,null,t.createElement("path",{d:"M160,48V208L80,128Z",opacity:"0.2"}),t.createElement("path",{d:"M163.06,40.61a8,8,0,0,0-8.72,1.73l-80,80a8,8,0,0,0,0,11.32l80,80A8,8,0,0,0,168,208V48A8,8,0,0,0,163.06,40.61ZM152,188.69,91.31,128,152,67.31Z"}))],["fill",t.createElement(t.Fragment,null,t.createElement("path",{d:"M168,48V208a8,8,0,0,1-13.66,5.66l-80-80a8,8,0,0,1,0-11.32l80-80A8,8,0,0,1,168,48Z"}))],["light",t.createElement(t.Fragment,null,t.createElement("path",{d:"M164.24,203.76a6,6,0,1,1-8.48,8.48l-80-80a6,6,0,0,1,0-8.48l80-80a6,6,0,0,1,8.48,8.48L88.49,128Z"}))],["regular",t.createElement(t.Fragment,null,t.createElement("path",{d:"M165.66,202.34a8,8,0,0,1-11.32,11.32l-80-80a8,8,0,0,1,0-11.32l80-80a8,8,0,0,1,11.32,11.32L91.31,128Z"}))],["thin",t.createElement(t.Fragment,null,t.createElement("path",{d:"M162.83,205.17a4,4,0,0,1-5.66,5.66l-80-80a4,4,0,0,1,0-5.66l80-80a4,4,0,1,1,5.66,5.66L85.66,128Z"}))]]);e.s(["default",()=>a])},14444,e=>{"use strict";var t=e.i(71645),a=e.i(75108),n=e.i(73987);let r=t.forwardRef((e,r)=>t.createElement(a.default,{ref:r,...e,weights:n.default}));r.displayName="CaretLeftIcon",e.s(["CaretLeft",()=>r])},38884,e=>{"use strict";var t=e.i(71645);let a=new Map([["bold",t.createElement(t.Fragment,null,t.createElement("path",{d:"M176.49,95.51a12,12,0,0,1,0,17l-56,56a12,12,0,0,1-17,0l-24-24a12,12,0,1,1,17-17L112,143l47.51-47.52A12,12,0,0,1,176.49,95.51ZM236,128A108,108,0,1,1,128,20,108.12,108.12,0,0,1,236,128Zm-24,0a84,84,0,1,0-84,84A84.09,84.09,0,0,0,212,128Z"}))],["duotone",t.createElement(t.Fragment,null,t.createElement("path",{d:"M224,128a96,96,0,1,1-96-96A96,96,0,0,1,224,128Z",opacity:"0.2"}),t.createElement("path",{d:"M173.66,98.34a8,8,0,0,1,0,11.32l-56,56a8,8,0,0,1-11.32,0l-24-24a8,8,0,0,1,11.32-11.32L112,148.69l50.34-50.35A8,8,0,0,1,173.66,98.34ZM232,128A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"}))],["fill",t.createElement(t.Fragment,null,t.createElement("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm45.66,85.66-56,56a8,8,0,0,1-11.32,0l-24-24a8,8,0,0,1,11.32-11.32L112,148.69l50.34-50.35a8,8,0,0,1,11.32,11.32Z"}))],["light",t.createElement(t.Fragment,null,t.createElement("path",{d:"M172.24,99.76a6,6,0,0,1,0,8.48l-56,56a6,6,0,0,1-8.48,0l-24-24a6,6,0,0,1,8.48-8.48L112,151.51l51.76-51.75A6,6,0,0,1,172.24,99.76ZM230,128A102,102,0,1,1,128,26,102.12,102.12,0,0,1,230,128Zm-12,0a90,90,0,1,0-90,90A90.1,90.1,0,0,0,218,128Z"}))],["regular",t.createElement(t.Fragment,null,t.createElement("path",{d:"M173.66,98.34a8,8,0,0,1,0,11.32l-56,56a8,8,0,0,1-11.32,0l-24-24a8,8,0,0,1,11.32-11.32L112,148.69l50.34-50.35A8,8,0,0,1,173.66,98.34ZM232,128A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"}))],["thin",t.createElement(t.Fragment,null,t.createElement("path",{d:"M170.83,101.17a4,4,0,0,1,0,5.66l-56,56a4,4,0,0,1-5.66,0l-24-24a4,4,0,0,1,5.66-5.66L112,154.34l53.17-53.17A4,4,0,0,1,170.83,101.17ZM228,128A100,100,0,1,1,128,28,100.11,100.11,0,0,1,228,128Zm-8,0a92,92,0,1,0-92,92A92.1,92.1,0,0,0,220,128Z"}))]]);e.s(["default",()=>a])},9089,e=>{"use strict";var t=e.i(71645),a=e.i(75108),n=e.i(38884);let r=t.forwardRef((e,r)=>t.createElement(a.default,{ref:r,...e,weights:n.default}));r.displayName="CheckCircleIcon",e.s(["CheckCircle",()=>r])},72587,e=>{"use strict";var t=e.i(71645),a=e.i(75108),n=e.i(27269);let r=t.forwardRef((e,r)=>t.createElement(a.default,{ref:r,...e,weights:n.default}));r.displayName="CircleNotchIcon",e.s(["CircleNotch",()=>r])},63129,e=>{"use strict";var t=e.i(71645),a=e.i(75108),n=e.i(79892);let r=t.forwardRef((e,r)=>t.createElement(a.default,{ref:r,...e,weights:n.default}));r.displayName="FileTextIcon",e.s(["FileText",()=>r])},44876,e=>{"use strict";var t=e.i(71645);let a=new Map([["bold",t.createElement(t.Fragment,null,t.createElement("path",{d:"M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Zm68-84a12,12,0,0,1-12,12H128a12,12,0,0,1-12-12V72a12,12,0,0,1,24,0v44h44A12,12,0,0,1,196,128Z"}))],["duotone",t.createElement(t.Fragment,null,t.createElement("path",{d:"M224,128a96,96,0,1,1-96-96A96,96,0,0,1,224,128Z",opacity:"0.2"}),t.createElement("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm64-88a8,8,0,0,1-8,8H128a8,8,0,0,1-8-8V72a8,8,0,0,1,16,0v48h48A8,8,0,0,1,192,128Z"}))],["fill",t.createElement(t.Fragment,null,t.createElement("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm56,112H128a8,8,0,0,1-8-8V72a8,8,0,0,1,16,0v48h48a8,8,0,0,1,0,16Z"}))],["light",t.createElement(t.Fragment,null,t.createElement("path",{d:"M128,26A102,102,0,1,0,230,128,102.12,102.12,0,0,0,128,26Zm0,192a90,90,0,1,1,90-90A90.1,90.1,0,0,1,128,218Zm62-90a6,6,0,0,1-6,6H128a6,6,0,0,1-6-6V72a6,6,0,0,1,12,0v50h50A6,6,0,0,1,190,128Z"}))],["regular",t.createElement(t.Fragment,null,t.createElement("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm64-88a8,8,0,0,1-8,8H128a8,8,0,0,1-8-8V72a8,8,0,0,1,16,0v48h48A8,8,0,0,1,192,128Z"}))],["thin",t.createElement(t.Fragment,null,t.createElement("path",{d:"M128,28A100,100,0,1,0,228,128,100.11,100.11,0,0,0,128,28Zm0,192a92,92,0,1,1,92-92A92.1,92.1,0,0,1,128,220Zm60-92a4,4,0,0,1-4,4H128a4,4,0,0,1-4-4V72a4,4,0,0,1,8,0v52h52A4,4,0,0,1,188,128Z"}))]]);e.s(["default",()=>a])},49427,e=>{"use strict";var t=e.i(71645),a=e.i(75108),n=e.i(44876);let r=t.forwardRef((e,r)=>t.createElement(a.default,{ref:r,...e,weights:n.default}));r.displayName="ClockIcon",e.s(["Clock",()=>r])},46951,e=>{"use strict";var t=e.i(71645),a=e.i(75108),n=e.i(97199);let r=t.forwardRef((e,r)=>t.createElement(a.default,{ref:r,...e,weights:n.default}));r.displayName="ArrowRightIcon",e.s(["ArrowRight",()=>r])},57693,e=>{"use strict";var t=e.i(71645),a=e.i(75108),n=e.i(25994);let r=t.forwardRef((e,r)=>t.createElement(a.default,{ref:r,...e,weights:n.default}));r.displayName="MagnifyingGlassIcon",e.s(["MagnifyingGlass",()=>r])},1589,e=>{"use strict";var t=e.i(71645);let a=new Map([["bold",t.createElement(t.Fragment,null,t.createElement("path",{d:"M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Zm-12-80V80a12,12,0,0,1,24,0v52a12,12,0,0,1-24,0Zm28,40a16,16,0,1,1-16-16A16,16,0,0,1,144,172Z"}))],["duotone",t.createElement(t.Fragment,null,t.createElement("path",{d:"M224,128a96,96,0,1,1-96-96A96,96,0,0,1,224,128Z",opacity:"0.2"}),t.createElement("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm-8-80V80a8,8,0,0,1,16,0v56a8,8,0,0,1-16,0Zm20,36a12,12,0,1,1-12-12A12,12,0,0,1,140,172Z"}))],["fill",t.createElement(t.Fragment,null,t.createElement("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm-8,56a8,8,0,0,1,16,0v56a8,8,0,0,1-16,0Zm8,104a12,12,0,1,1,12-12A12,12,0,0,1,128,184Z"}))],["light",t.createElement(t.Fragment,null,t.createElement("path",{d:"M128,26A102,102,0,1,0,230,128,102.12,102.12,0,0,0,128,26Zm0,192a90,90,0,1,1,90-90A90.1,90.1,0,0,1,128,218Zm-6-82V80a6,6,0,0,1,12,0v56a6,6,0,0,1-12,0Zm16,36a10,10,0,1,1-10-10A10,10,0,0,1,138,172Z"}))],["regular",t.createElement(t.Fragment,null,t.createElement("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm-8-80V80a8,8,0,0,1,16,0v56a8,8,0,0,1-16,0Zm20,36a12,12,0,1,1-12-12A12,12,0,0,1,140,172Z"}))],["thin",t.createElement(t.Fragment,null,t.createElement("path",{d:"M128,28A100,100,0,1,0,228,128,100.11,100.11,0,0,0,128,28Zm0,192a92,92,0,1,1,92-92A92.1,92.1,0,0,1,128,220Zm-4-84V80a4,4,0,0,1,8,0v56a4,4,0,0,1-8,0Zm12,36a8,8,0,1,1-8-8A8,8,0,0,1,136,172Z"}))]]);e.s(["default",()=>a])},29587,e=>{"use strict";var t=e.i(71645),a=e.i(75108),n=e.i(1589);let r=t.forwardRef((e,r)=>t.createElement(a.default,{ref:r,...e,weights:n.default}));r.displayName="WarningCircleIcon",e.s(["WarningCircle",()=>r])},55162,e=>{"use strict";var t=e.i(71645);let a=new Map([["bold",t.createElement(t.Fragment,null,t.createElement("path",{d:"M244,56v64a12,12,0,0,1-24,0V85l-75.51,75.52a12,12,0,0,1-17,0L96,129,32.49,192.49a12,12,0,0,1-17-17l72-72a12,12,0,0,1,17,0L136,135l67-67H168a12,12,0,0,1,0-24h64A12,12,0,0,1,244,56Z"}))],["duotone",t.createElement(t.Fragment,null,t.createElement("path",{d:"M232,56v64L168,56Z",opacity:"0.2"}),t.createElement("path",{d:"M232,48H168a8,8,0,0,0-5.66,13.66L188.69,88,136,140.69l-34.34-34.35a8,8,0,0,0-11.32,0l-72,72a8,8,0,0,0,11.32,11.32L96,123.31l34.34,34.35a8,8,0,0,0,11.32,0L200,99.31l26.34,26.35A8,8,0,0,0,240,120V56A8,8,0,0,0,232,48Zm-8,52.69L187.31,64H224Z"}))],["fill",t.createElement(t.Fragment,null,t.createElement("path",{d:"M240,56v64a8,8,0,0,1-13.66,5.66L200,99.31l-58.34,58.35a8,8,0,0,1-11.32,0L96,123.31,29.66,189.66a8,8,0,0,1-11.32-11.32l72-72a8,8,0,0,1,11.32,0L136,140.69,188.69,88,162.34,61.66A8,8,0,0,1,168,48h64A8,8,0,0,1,240,56Z"}))],["light",t.createElement(t.Fragment,null,t.createElement("path",{d:"M238,56v64a6,6,0,0,1-12,0V70.48l-85.76,85.76a6,6,0,0,1-8.48,0L96,120.49,28.24,188.24a6,6,0,0,1-8.48-8.48l72-72a6,6,0,0,1,8.48,0L136,143.51,217.52,62H168a6,6,0,0,1,0-12h64A6,6,0,0,1,238,56Z"}))],["regular",t.createElement(t.Fragment,null,t.createElement("path",{d:"M240,56v64a8,8,0,0,1-16,0V75.31l-82.34,82.35a8,8,0,0,1-11.32,0L96,123.31,29.66,189.66a8,8,0,0,1-11.32-11.32l72-72a8,8,0,0,1,11.32,0L136,140.69,212.69,64H168a8,8,0,0,1,0-16h64A8,8,0,0,1,240,56Z"}))],["thin",t.createElement(t.Fragment,null,t.createElement("path",{d:"M236,56v64a4,4,0,0,1-8,0V65.66l-89.17,89.17a4,4,0,0,1-5.66,0L96,117.66,26.83,186.83a4,4,0,0,1-5.66-5.66l72-72a4,4,0,0,1,5.66,0L136,146.34,222.34,60H168a4,4,0,0,1,0-8h64A4,4,0,0,1,236,56Z"}))]]);e.s(["default",()=>a])},6731,e=>{"use strict";var t=e.i(71645),a=e.i(75108);let n=new Map([["bold",t.createElement(t.Fragment,null,t.createElement("path",{d:"M192.94,189.66a12,12,0,0,1-.94,17A84,84,0,0,1,53.55,160H40a12,12,0,0,1,0-24H52V120H40a12,12,0,0,1,0-24H53.55A84,84,0,0,1,192,49.39a12,12,0,0,1-16,17.89A60,60,0,0,0,78.18,96H136a12,12,0,0,1,0,24H76v16h44a12,12,0,0,1,0,24H78.18A60,60,0,0,0,176,188.72,12,12,0,0,1,192.94,189.66Z"}))],["duotone",t.createElement(t.Fragment,null,t.createElement("path",{d:"M184,58.33V197.67A72,72,0,0,1,64,144V112A72,72,0,0,1,184,58.33Z",opacity:"0.2"}),t.createElement("path",{d:"M190,192.33a8,8,0,0,1-.63,11.3A80,80,0,0,1,56.4,152H40a8,8,0,0,1,0-16H56V120H40a8,8,0,0,1,0-16H56.4A80,80,0,0,1,189.34,52.37,8,8,0,0,1,178.66,64.3,64,64,0,0,0,72.52,104H136a8,8,0,0,1,0,16H72v16h48a8,8,0,0,1,0,16H72.52a64,64,0,0,0,106.14,39.71A8,8,0,0,1,190,192.33Z"}))],["fill",t.createElement(t.Fragment,null,t.createElement("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,80a8,8,0,0,1,0,16H88v16h24a8,8,0,0,1,0,16H88.81a40,40,0,0,0,65.86,21.82,8,8,0,1,1,10.66,11.92A56,56,0,0,1,72.58,152H64a8,8,0,0,1,0-16h8V120H64a8,8,0,0,1,0-16h8.58a56,56,0,0,1,92.75-33.74,8,8,0,1,1-10.66,11.92A40,40,0,0,0,88.81,104Z"}))],["light",t.createElement(t.Fragment,null,t.createElement("path",{d:"M188.47,193.66a6,6,0,0,1-.47,8.48A78,78,0,0,1,58.25,150H40a6,6,0,0,1,0-12H58V118H40a6,6,0,0,1,0-12H58.25A78,78,0,0,1,188,53.86a6,6,0,0,1-8,9A66,66,0,0,0,70.29,106H136a6,6,0,0,1,0,12H70v20h50a6,6,0,0,1,0,12H70.29A66,66,0,0,0,180,193.2,6,6,0,0,1,188.47,193.66Z"}))],["regular",t.createElement(t.Fragment,null,t.createElement("path",{d:"M190,192.33a8,8,0,0,1-.63,11.3A80,80,0,0,1,56.4,152H40a8,8,0,0,1,0-16H56V120H40a8,8,0,0,1,0-16H56.4A80,80,0,0,1,189.34,52.37,8,8,0,0,1,178.66,64.3,64,64,0,0,0,72.52,104H136a8,8,0,0,1,0,16H72v16h48a8,8,0,0,1,0,16H72.52a64,64,0,0,0,106.14,39.71A8,8,0,0,1,190,192.33Z"}))],["thin",t.createElement(t.Fragment,null,t.createElement("path",{d:"M187,195a4,4,0,0,1-.31,5.65A76,76,0,0,1,60.11,148H40a4,4,0,0,1,0-8H60V116H40a4,4,0,0,1,0-8H60.11A76,76,0,0,1,186.67,55.35a4,4,0,1,1-5.34,6A68,68,0,0,0,68.13,108H136a4,4,0,0,1,0,8H68v24h52a4,4,0,0,1,0,8H68.13a68,68,0,0,0,113.2,46.69A4,4,0,0,1,187,195Z"}))]]),r=t.forwardRef((e,r)=>t.createElement(a.default,{ref:r,...e,weights:n}));r.displayName="CurrencyEurIcon",e.s(["CurrencyEur",()=>r],6731)},86470,e=>{"use strict";var t=e.i(90615);async function a(e,a,n){let r=(0,t.createClient)(),l=n.reduce((e,t)=>e+t.amount*(t.quantity||1),0),s=`INV-${new Date().getFullYear()}-${Math.floor(1e3+9e3*Math.random())}`,{data:i,error:c}=await r.from("housing_invoices").insert({student_id:e,application_id:a||null,reference_number:s,total_amount:l,status:"PENDING",due_date:new Date(Date.now()+6048e5).toISOString(),currency:"EUR"}).select().single();if(c)throw Error(`Failed to create invoice: ${c.message}`);let o=n.map(e=>({invoice_id:i.id,description:e.description,item_type:e.type,amount:e.amount,quantity:e.quantity||1})),{error:d}=await r.from("housing_invoice_items").insert(o);if(d)throw Error(`Failed to create invoice items: ${d.message}`);return i}async function n(e,a,n){try{let r=(0,t.createClient)(),{data:{user:l}}=await r.auth.getUser();if(!l)return{success:!1,error:"Not authenticated"};let{data:s}=await r.from("housing_invoices").select("*, student:students(id)").eq("id",e).single();if(!s)return{success:!1,error:"Invoice not found"};let i=`PGW-${Date.now()}-${Math.floor(1e3*Math.random())}`,c=`https://kestora.online/portal/application/payment/verify?ref=${i}`,{error:o}=await r.from("housing_payments").insert({invoice_id:e,student_id:s.student_id,amount:s.total_amount-(s.paid_amount||0),currency:s.currency,status:"PENDING",payment_method:a,billing_country:n,paygowire_transaction_id:i,paygowire_payment_url:c});if(o)return console.error("Payment creation error:",o),{success:!1,error:"Failed to initiate payment transaction"};return{success:!0,paymentUrl:c,transactionId:i}}catch(e){return{success:!1,error:e.message}}}async function r(e){let a=(0,t.createClient)();try{let{data:t}=await a.from("housing_payments").select("*, invoice:housing_invoices(*)").eq("paygowire_transaction_id",e).single();if(!t)return{success:!1,error:"Payment transaction not found"};if("COMPLETED"===t.status)return{success:!0};let{error:n}=await a.from("housing_payments").update({status:"COMPLETED",paid_at:new Date().toISOString()}).eq("id",t.id);if(n)throw n;let{data:r}=await a.from("housing_invoices").select("*").eq("id",t.invoice_id).single();if(r){let n=(r.paid_amount||0)+t.amount,l=n>=r.total_amount;await a.from("housing_invoices").update({paid_amount:n,status:l?"PAID":"PARTIALLY_PAID"}).eq("id",t.invoice_id),l&&r.application_id&&await a.from("housing_applications").update({status:"APPROVED"}).eq("id",r.application_id);try{await a.functions.invoke("send-notification",{body:{type:"PAYMENT_RECEIVED",applicationId:r.application_id||void 0,additionalData:{amount:t.amount,currency:t.currency,reference:e,paymentType:"HOUSING"}}})}catch(e){console.error("Failed to trigger housing payment notification:",e)}}return{success:!0}}catch(e){return console.error("Verify payment error:",e),{success:!1,error:e.message}}}async function l(e,n){let r=(0,t.createClient)(),{data:{user:l}}=await r.auth.getUser();if(!l)throw Error("Not authenticated");let{data:s}=await r.from("housing_assignments").select("*, room:housing_rooms(*)").eq("status","ASSIGNED");if(!s)return{success:!0,count:0};let i=0;for(let t of s){let l=`RENT-${n}-${e.toString().padStart(2,"0")}`,{data:s}=await r.from("housing_invoices").select("id").eq("student_id",t.student_id).ilike("reference_number",`${l}%`).single();!s&&(await a(t.student_id,t.application_id,[{description:`Monthly Rent - ${new Intl.DateTimeFormat("en-US",{month:"long"}).format(new Date(n,e-1))} ${n}`,type:"MONTHLY_RENT",amount:t.room?.monthly_rate||600}]),i++)}return{success:!0,count:i}}async function s(e){let a=(0,t.createClient)(),{data:{user:n}}=await a.auth.getUser();if(!n)throw Error("Not authenticated");let{data:r,error:l}=await a.from("housing_payments").select("*, invoice:housing_invoices(*)").eq("id",e).single();if(l||!r)throw Error(`Payment not found: ${l?.message}`);if("COMPLETED"===r.status)return{success:!0};let s=r.invoice;if(!s)throw Error("Invoice not found for this payment");let{error:i}=await a.from("housing_payments").update({status:"COMPLETED",paid_at:new Date().toISOString(),verified:!0,metadata:{...r.metadata,reconciled_by:n.id,reconciled_at:new Date().toISOString()}}).eq("id",e);if(i)throw i;let c=(s.paid_amount||0)+r.amount,o=c>=s.total_amount,{error:d}=await a.from("housing_invoices").update({paid_amount:c,status:o?"PAID":"PARTIALLY_PAID",updated_at:new Date().toISOString()}).eq("id",s.id);if(d)throw d;o&&s.application_id&&await a.from("housing_applications").update({status:"APPROVED"}).eq("id",s.application_id);try{await a.functions.invoke("send-notification",{body:{type:"PAYMENT_RECEIVED",applicationId:s.application_id||void 0,additionalData:{amount:r.amount,currency:r.currency,reference:r.paygowire_transaction_id||r.id,paymentType:"HOUSING"}}})}catch(e){console.error("Failed to trigger reconcile notification:",e)}return{success:!0}}async function i(e){let a=(0,t.createClient)(),{data:n,error:r}=await a.from("students").select("*, user:profiles(*)").or(`first_name.ilike.%${e}%,last_name.ilike.%${e}%,student_id.ilike.%${e}%`,{foreignTable:"profiles"}).limit(10);if(r)throw r;return n}async function c(e,a,n="BANK_TRANSFER",r){let l=(0,t.createClient)(),{data:{user:s}}=await l.auth.getUser();if(!s)throw Error("Not authenticated");let{data:i}=await l.from("housing_invoices").select("*, student:students(*, user:profiles(*))").eq("id",e).single();if(!i)throw Error("Invoice not found");await l.from("housing_payments").insert({invoice_id:e,student_id:i.student_id,amount:a,currency:i.currency,status:"COMPLETED",payment_method:n,billing_country:"Manual Verification",paid_at:new Date().toISOString(),verified:!0,metadata:{verified_by:s.id,manual_reference:r||"Manual Admin Action",verification_date:new Date().toISOString()}});let o=(i.paid_amount||0)+a,d=o>=i.total_amount;await l.from("housing_invoices").update({paid_amount:o,status:d?"PAID":"PARTIALLY_PAID",updated_at:new Date().toISOString()}).eq("id",e),d&&i.application_id&&await l.from("housing_applications").update({status:"APPROVED"}).eq("id",i.application_id);try{await l.functions.invoke("send-notification",{body:{type:"PAYMENT_RECEIVED",applicationId:i.application_id||void 0,additionalData:{amount:a,currency:i.currency,reference:r||"MANUAL-VERIF",paymentType:"HOUSING"}}})}catch(e){console.error("Failed to trigger manual payment notification:",e)}return{success:!0}}e.s(["batchGenerateInvoices",()=>l,"generateHousingInvoice",()=>a,"initiatePayment",()=>n,"reconcilePayment",()=>s,"searchStudents",()=>i,"verifyHousingPaymentManually",()=>c,"verifyPayment",()=>r])},92947,e=>{"use strict";var t=e.i(43476),a=e.i(71645),n=e.i(90615),r=e.i(18566),l=e.i(22016),s=e.i(14444),i=e.i(72587);e.i(47167);var c=e.i(6731),o=e.i(63129),d=e.i(75108),u=e.i(55162);let m=a.forwardRef((e,t)=>a.createElement(d.default,{ref:t,...e,weights:u.default}));m.displayName="TrendUpIcon";var p=e.i(9089),h=e.i(49427),x=e.i(29587),b=e.i(57693),f=e.i(46951),g=e.i(58697),v=e.i(86470);function y({initialInvoices:e,initialPayments:n,students:r}){let[l,s]=(0,a.useState)(e),[i,d]=(0,a.useState)(n),[u,y]=(0,a.useState)("invoices"),[N,w]=(0,a.useState)(""),[E,j]=(0,a.useState)("ALL"),[_,k]=(0,a.useState)(!1),[A,C]=(0,a.useState)(!1),[M,I]=(0,a.useState)(new Date().getMonth()+1),[Z,S]=(0,a.useState)(new Date().getFullYear()),[D,L]=(0,a.useState)(!1),[F,H]=(0,a.useState)(null),[P,R]=(0,a.useState)(""),[T,V]=(0,a.useState)("BANK_TRANSFER"),[O,$]=(0,a.useState)(!1),[G,Y]=(0,a.useState)(""),[U,q]=(0,a.useState)(""),[z,B]=(0,a.useState)(""),[K,W]=(0,a.useState)("HOUSING_DEPOSIT"),[J,Q]=(0,a.useState)(""),[X,ee]=(0,a.useState)(r),et={totalRevenue:i.filter(e=>"COMPLETED"===e.status).reduce((e,t)=>e+Number(t.amount),0),pendingInvoices:l.filter(e=>"PENDING"===e.status).length,totalInvoiced:l.reduce((e,t)=>e+Number(t.total_amount),0),completionRate:l.length>0?Math.round(l.filter(e=>"PAID"===e.status).length/l.length*100):0},ea=l.filter(e=>{let t=e.reference_number.toLowerCase().includes(N.toLowerCase())||`${e.student?.user?.first_name} ${e.student?.user?.last_name}`.toLowerCase().includes(N.toLowerCase()),a="ALL"===E||e.status===E;return t&&a}),en=i.filter(e=>{let t=e.paygowire_transaction_id?.toLowerCase().includes(N.toLowerCase())||`${e.student?.user?.first_name} ${e.student?.user?.last_name}`.toLowerCase().includes(N.toLowerCase()),a="ALL"===E||e.status===E;return t&&a}),er=async()=>{k(!0);try{let e=await (0,v.batchGenerateInvoices)(M,Z);e.success&&(alert(`Successfully generated ${e.count} invoices.`),C(!1),window.location.reload())}catch(e){alert(e.message)}finally{k(!1)}},el=async e=>{if(confirm("Are you sure you want to manually reconcile this payment?")){k(!0);try{(await (0,v.reconcilePayment)(e)).success&&(alert("Payment reconciled successfully."),window.location.reload())}catch(e){alert(e.message)}finally{k(!1)}}},es=e=>{switch(e){case"PAID":case"COMPLETED":return"bg-green-100 text-green-700 border-green-200";case"PENDING_VERIFICATION":return"bg-blue-100 text-blue-700 border-blue-200 ring-2 ring-blue-500 ring-opacity-20";case"PENDING":case"PROCESSING":return"bg-amber-100 text-amber-700 border-amber-200";case"FAILED":case"CANCELLED":case"OVERDUE":return"bg-red-100 text-red-700 border-red-200";default:return"bg-neutral-100 text-neutral-700 border-neutral-200"}};return(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-black uppercase tracking-tighter mb-1",children:"Finance Console"}),(0,t.jsx)("p",{className:"text-[10px] font-bold text-neutral-500 uppercase tracking-widest",children:"Housing Payments & Invoice Management"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>$(!0),className:"px-4 py-2 border-2 border-black text-black rounded-sm text-[10px] font-black uppercase tracking-widest hover:bg-neutral-50 transition-all",children:"New Individual Invoice"}),(0,t.jsx)("button",{onClick:()=>C(!0),className:"px-4 py-2 bg-black text-white rounded-sm text-[10px] font-black uppercase tracking-widest hover:bg-neutral-800 transition-all",children:"Generate Batch Invoices"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{className:"bg-white border-2 border-black p-6 rounded-sm shadow-[4px_4px_0px_0px_rgba(0,0,0,0.1)]",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,t.jsx)(m,{size:20,weight:"bold",className:"text-neutral-400"}),(0,t.jsx)("span",{className:"text-[8px] font-black uppercase text-green-600 bg-green-50 px-2 py-0.5 rounded-full",children:"+12% vs last mo"})]}),(0,t.jsx)("p",{className:"text-[10px] font-black uppercase text-neutral-400 mb-1",children:"Total Revenue"}),(0,t.jsxs)("p",{className:"text-2xl font-black",children:["€",et.totalRevenue.toLocaleString()]})]}),(0,t.jsxs)("div",{className:"bg-white border-2 border-black p-6 rounded-sm shadow-[4px_4px_0px_0px_rgba(0,0,0,0.1)]",children:[(0,t.jsx)(h.Clock,{size:20,weight:"bold",className:"text-amber-500 mb-2"}),(0,t.jsx)("p",{className:"text-[10px] font-black uppercase text-neutral-400 mb-1",children:"Pending Invoices"}),(0,t.jsx)("p",{className:"text-2xl font-black",children:et.pendingInvoices})]}),(0,t.jsxs)("div",{className:"bg-white border-2 border-black p-6 rounded-sm shadow-[4px_4px_0px_0px_rgba(0,0,0,0.1)]",children:[(0,t.jsx)(o.FileText,{size:20,weight:"bold",className:"text-neutral-400 mb-2"}),(0,t.jsx)("p",{className:"text-[10px] font-black uppercase text-neutral-400 mb-1",children:"Total Invoiced"}),(0,t.jsxs)("p",{className:"text-2xl font-black",children:["€",et.totalInvoiced.toLocaleString()]})]}),(0,t.jsxs)("div",{className:"bg-white border-2 border-black p-6 rounded-sm shadow-[4px_4px_0px_0px_rgba(0,0,0,0.1)]",children:[(0,t.jsx)(p.CheckCircle,{size:20,weight:"bold",className:"text-neutral-400 mb-2"}),(0,t.jsx)("p",{className:"text-[10px] font-black uppercase text-neutral-400 mb-1",children:"Collection Rate"}),(0,t.jsxs)("p",{className:"text-2xl font-black",children:[et.completionRate,"%"]})]})]}),(0,t.jsxs)("div",{className:"bg-white border-2 border-black p-4 rounded-sm flex flex-col md:flex-row gap-4",children:[(0,t.jsxs)("div",{className:"flex-1 relative",children:[(0,t.jsx)(b.MagnifyingGlass,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400",size:16,weight:"bold"}),(0,t.jsx)("input",{type:"text",placeholder:"Search by student or reference...",className:"w-full pl-10 pr-4 py-2 border-2 border-neutral-100 focus:border-black outline-none transition-all text-sm font-bold uppercase",value:N,onChange:e=>w(e.target.value)})]}),(0,t.jsx)("div",{className:"flex gap-2",children:(0,t.jsxs)("select",{className:"px-4 py-2 border-2 border-neutral-100 focus:border-black outline-none transition-all text-[10px] font-black uppercase tracking-widest bg-white",value:E,onChange:e=>j(e.target.value),children:[(0,t.jsx)("option",{value:"ALL",children:"All Status"}),(0,t.jsx)("option",{value:"PENDING",children:"Pending"}),(0,t.jsx)("option",{value:"PAID",children:"Paid"}),(0,t.jsx)("option",{value:"CANCELLED",children:"Cancelled"}),(0,t.jsx)("option",{value:"OVERDUE",children:"Overdue"})]})})]}),(0,t.jsx)("div",{className:"border-b-2 border-neutral-200",children:(0,t.jsxs)("div",{className:"flex gap-8",children:[(0,t.jsxs)("button",{onClick:()=>y("invoices"),className:`pb-4 text-[10px] font-black uppercase tracking-widest transition-all relative ${"invoices"===u?"text-black":"text-neutral-400 hover:text-neutral-600"}`,children:["Invoices","invoices"===u&&(0,t.jsx)("div",{className:"absolute bottom-0 left-0 w-full h-1 bg-black"})]}),(0,t.jsxs)("button",{onClick:()=>y("payments"),className:`pb-4 text-[10px] font-black uppercase tracking-widest transition-all relative ${"payments"===u?"text-black":"text-neutral-400 hover:text-neutral-600"}`,children:["Payments","payments"===u&&(0,t.jsx)("div",{className:"absolute bottom-0 left-0 w-full h-1 bg-black"})]})]})}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full border-collapse",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"border-b-2 border-black",children:[(0,t.jsx)("th",{className:"text-left py-4 px-2 text-[10px] font-black uppercase tracking-widest text-neutral-400",children:"Reference / ID"}),(0,t.jsx)("th",{className:"text-left py-4 px-2 text-[10px] font-black uppercase tracking-widest text-neutral-400",children:"Student"}),(0,t.jsx)("th",{className:"text-left py-4 px-2 text-[10px] font-black uppercase tracking-widest text-neutral-400",children:"Amount"}),(0,t.jsx)("th",{className:"text-left py-4 px-2 text-[10px] font-black uppercase tracking-widest text-neutral-400",children:"Status"}),(0,t.jsx)("th",{className:"text-left py-4 px-2 text-[10px] font-black uppercase tracking-widest text-neutral-400",children:"Date"}),(0,t.jsx)("th",{className:"text-right py-4 px-2 text-[10px] font-black uppercase tracking-widest text-neutral-400",children:"Actions"})]})}),(0,t.jsx)("tbody",{children:"invoices"===u?ea.map(e=>(0,t.jsxs)("tr",{className:"border-b border-neutral-100 hover:bg-neutral-50 transition-colors",children:[(0,t.jsx)("td",{className:"py-4 px-2",children:(0,t.jsx)("p",{className:"font-black text-sm",children:e.reference_number})}),(0,t.jsxs)("td",{className:"py-4 px-2",children:[(0,t.jsxs)("p",{className:"font-bold text-sm",children:[e.student?.user?.first_name," ",e.student?.user?.last_name]}),(0,t.jsxs)("p",{className:"text-[8px] font-bold text-neutral-400 uppercase",children:["ID: ",e.student?.id]})]}),(0,t.jsx)("td",{className:"py-4 px-2",children:(0,t.jsxs)("p",{className:"font-black",children:["€",Number(e.total_amount).toLocaleString()]})}),(0,t.jsx)("td",{className:"py-4 px-2",children:(0,t.jsx)("span",{className:`px-2 py-1 border-2 rounded-sm text-[8px] font-black uppercase ${es(e.status)}`,children:e.status})}),(0,t.jsx)("td",{className:"py-4 px-2 text-[10px] font-bold text-neutral-500 uppercase",children:(0,g.formatToDDMMYYYY)(e.created_at)}),(0,t.jsx)("td",{className:"py-4 px-2 text-right",children:(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:["PAID"!==e.status&&(0,t.jsx)("button",{onClick:()=>{H(e.id),R((e.total_amount-(e.paid_amount||0)).toString()),L(!0)},title:"Mark as Paid (Manual)",className:"p-2 border border-neutral-200 rounded-sm hover:border-green-500 hover:text-green-600 transition-all text-green-600",children:(0,t.jsx)(c.CurrencyEur,{size:14,weight:"bold"})}),(0,t.jsx)("button",{className:"p-2 border border-neutral-200 rounded-sm hover:border-black transition-all",children:(0,t.jsx)(x.WarningCircle,{size:14,weight:"bold"})}),(0,t.jsx)("button",{className:"p-2 border border-neutral-200 rounded-sm hover:border-black transition-all",children:(0,t.jsx)(f.ArrowRight,{size:14,weight:"bold"})})]})})]},e.id)):en.map(e=>(0,t.jsxs)("tr",{className:"border-b border-neutral-100 hover:bg-neutral-50 transition-colors",children:[(0,t.jsxs)("td",{className:"py-4 px-2",children:[(0,t.jsx)("p",{className:"font-black text-sm truncate max-w-[120px]",children:e.paygowire_transaction_id||e.id.slice(0,8)}),(0,t.jsx)("p",{className:"text-[8px] font-bold text-neutral-400 uppercase",children:e.invoice?.reference_number})]}),(0,t.jsxs)("td",{className:"py-4 px-2",children:[(0,t.jsxs)("p",{className:"font-bold text-sm",children:[e.student?.user?.first_name," ",e.student?.user?.last_name]}),(0,t.jsxs)("p",{className:"text-[8px] font-bold text-neutral-400 uppercase",children:["Method: ",e.payment_method]})]}),(0,t.jsx)("td",{className:"py-4 px-2",children:(0,t.jsxs)("p",{className:"font-black",children:["€",Number(e.amount).toLocaleString()]})}),(0,t.jsxs)("td",{className:"py-4 px-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:`px-2 py-1 border-2 rounded-sm text-[8px] font-black uppercase ${es(e.status)}`,children:e.status}),e.verified&&(0,t.jsx)("span",{title:"Verified by Admin",children:(0,t.jsx)(p.CheckCircle,{size:14,weight:"fill",className:"text-green-500"})})]}),e.metadata?.proof_path&&(0,t.jsxs)("a",{href:`https://mrqzlmkdhzwvbpljikjz.supabase.co/storage/v1/object/public/housing_payments/${e.metadata.proof_path}`,target:"_blank",className:"text-[8px] font-black text-blue-600 hover:underline flex items-center gap-1 mt-1",children:[(0,t.jsx)(o.FileText,{size:10})," View Proof"]})]}),(0,t.jsx)("td",{className:"py-4 px-2 text-[10px] font-bold text-neutral-500 uppercase",children:(0,g.formatToDDMMYYYY)(e.created_at)}),(0,t.jsx)("td",{className:"py-4 px-2 text-right",children:(0,t.jsx)("div",{className:"flex justify-end gap-2",children:("PENDING_VERIFICATION"===e.status||"PENDING"===e.status)&&(0,t.jsx)("button",{onClick:()=>el(e.id),disabled:_,title:"Verify & Reconcile",className:"p-2 border-2 border-green-500 text-green-600 rounded-sm hover:bg-green-50 transition-all disabled:opacity-50",children:(0,t.jsx)(p.CheckCircle,{size:14,weight:"bold"})})})})]},e.id))})]})}),0===("invoices"===u?ea:en).length&&(0,t.jsx)("div",{className:"py-20 text-center bg-white border-2 border-dashed border-neutral-200 rounded-sm",children:(0,t.jsx)("p",{className:"text-neutral-400 font-bold uppercase tracking-widest text-xs",children:"No records found matching your filters."})}),A&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-white border-4 border-black p-8 max-w-md w-full shadow-[8px_8px_0px_0px_rgba(0,0,0,1)]",children:[(0,t.jsx)("h2",{className:"text-xl font-black uppercase mb-4",children:"Batch Invoice Generation"}),(0,t.jsx)("p",{className:"text-sm text-neutral-600 mb-6 font-bold uppercase tracking-tight",children:"Select the month and year to generate rent invoices for all active housing assignments."}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-[10px] font-black uppercase text-neutral-400 mb-1",children:"Month"}),(0,t.jsx)("select",{className:"w-full px-2 py-1 border-2 border-black font-bold outline-none",value:M,onChange:e=>I(Number(e.target.value)),children:Array.from({length:12},(e,a)=>(0,t.jsx)("option",{value:a+1,children:new Intl.DateTimeFormat("en-US",{month:"long"}).format(new Date(2026,a))},a+1))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-[10px] font-black uppercase text-neutral-400 mb-1",children:"Year"}),(0,t.jsxs)("select",{className:"w-full px-2 py-1 border-2 border-black font-bold outline-none",value:Z,onChange:e=>S(Number(e.target.value)),children:[(0,t.jsx)("option",{value:2026,children:"2026"}),(0,t.jsx)("option",{value:2027,children:"2027"})]})]})]}),(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsx)("button",{onClick:()=>C(!1),className:"flex-1 py-3 border-2 border-black text-[10px] font-black uppercase tracking-widest hover:bg-neutral-100 transition-all",children:"Cancel"}),(0,t.jsx)("button",{onClick:er,disabled:_,className:"flex-1 py-3 bg-black text-white text-[10px] font-black uppercase tracking-widest hover:bg-neutral-800 transition-all disabled:opacity-50",children:_?"Generating...":"Run Batch"})]})]})}),O&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-white border-4 border-black p-8 max-w-lg w-full shadow-[8px_8px_0px_0px_rgba(0,0,0,1)]",children:[(0,t.jsx)("h2",{className:"text-xl font-black uppercase mb-4",children:"Create Individual Invoice"}),(0,t.jsx)("p",{className:"text-sm text-neutral-600 mb-6 font-bold uppercase tracking-tight",children:"Generate a custom invoice for a specific student."}),(0,t.jsxs)("div",{className:"space-y-4 mb-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-[10px] font-black uppercase text-neutral-400 mb-1",children:"Select Student"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("input",{type:"text",placeholder:"Search by name or ID...",className:"w-full px-4 py-3 border-2 border-black font-bold outline-none mb-2",value:J,onChange:async e=>{Q(e.target.value),e.target.value.length>2?ee(await (0,v.searchStudents)(e.target.value)):0===e.target.value.length&&ee(r)}}),J&&""===G&&(0,t.jsx)("div",{className:"bg-white border-2 border-black max-h-40 overflow-y-auto mb-4",children:X.map(e=>(0,t.jsxs)("button",{type:"button",onClick:()=>{Y(e.id),Q(`${e.user?.first_name} ${e.user?.last_name}`),ee([])},className:`w-full text-left px-4 py-2 text-xs font-bold uppercase hover:bg-neutral-50 ${G===e.id?"bg-neutral-100":""}`,children:[e.user?.first_name," ",e.user?.last_name," (",e.student_id,")"]},e.id))}),G&&(0,t.jsx)("button",{onClick:()=>{Y(""),Q(""),ee(r)},className:"text-[8px] font-bold text-red-500 uppercase tracking-widest mt-1 hover:underline",children:"Change Student"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-[10px] font-black uppercase text-neutral-400 mb-1",children:"Amount (€)"}),(0,t.jsx)("input",{type:"number",className:"w-full px-4 py-3 border-2 border-black font-bold outline-none",placeholder:"0.00",value:U,onChange:e=>q(e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-[10px] font-black uppercase text-neutral-400 mb-1",children:"Type"}),(0,t.jsxs)("select",{className:"w-full px-4 py-3 border-2 border-black font-bold outline-none bg-white",value:K,onChange:e=>W(e.target.value),children:[(0,t.jsx)("option",{value:"HOUSING_DEPOSIT",children:"Deposit"}),(0,t.jsx)("option",{value:"MONTHLY_RENT",children:"Monthly Rent"}),(0,t.jsx)("option",{value:"UTILITIES",children:"Utilities"}),(0,t.jsx)("option",{value:"CLEANING_FEE",children:"Cleaning Fee"}),(0,t.jsx)("option",{value:"LATE_FEE",children:"Late Fee"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-[10px] font-black uppercase text-neutral-400 mb-1",children:"Description"}),(0,t.jsx)("textarea",{className:"w-full px-4 py-3 border-2 border-black font-bold outline-none",rows:2,placeholder:"e.g., Security Deposit for Block A",value:z,onChange:e=>B(e.target.value)})]})]}),(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsx)("button",{onClick:()=>{$(!1),Y(""),Q(""),q(""),B("")},className:"flex-1 py-3 border-2 border-black text-[10px] font-black uppercase tracking-widest hover:bg-neutral-100 transition-all",children:"Cancel"}),(0,t.jsx)("button",{onClick:async()=>{if(!G||!U||!z)return void alert("Please fill all fields");k(!0);try{await (0,v.generateHousingInvoice)(G,null,[{description:z,type:K,amount:Number(U)}]),alert("Invoice generated successfully"),window.location.reload()}catch(e){alert(e.message)}finally{k(!1)}},disabled:_,className:"flex-1 py-3 bg-black text-white text-[10px] font-black uppercase tracking-widest hover:bg-neutral-800 transition-all disabled:opacity-50",children:_?"Generating...":"Create Invoice"})]})]})}),D&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-white border-4 border-black p-8 max-w-sm w-full shadow-[8px_8px_0px_0px_rgba(0,0,0,1)]",children:[(0,t.jsx)("h2",{className:"text-xl font-black uppercase mb-4",children:"Manual Payment Verification"}),(0,t.jsx)("p",{className:"text-sm text-neutral-600 mb-6 font-bold uppercase tracking-tight",children:"Confirm receipt of payment outside the system (e.g., Cash, Bank Transfer)."}),(0,t.jsxs)("div",{className:"space-y-4 mb-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-[10px] font-black uppercase text-neutral-400 mb-1",children:"Amount Received (€)"}),(0,t.jsx)("input",{type:"number",className:"w-full px-4 py-3 border-2 border-black font-bold outline-none",value:P,onChange:e=>R(e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-[10px] font-black uppercase text-neutral-400 mb-1",children:"Payment Method"}),(0,t.jsxs)("select",{className:"w-full px-4 py-3 border-2 border-black font-bold outline-none bg-white",value:T,onChange:e=>V(e.target.value),children:[(0,t.jsx)("option",{value:"BANK_TRANSFER",children:"Bank Transfer"}),(0,t.jsx)("option",{value:"CASH",children:"Cash"}),(0,t.jsx)("option",{value:"CHECK",children:"Check"}),(0,t.jsx)("option",{value:"OTHER",children:"Other"})]})]})]}),(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsx)("button",{onClick:()=>{L(!1),H(null),R("")},className:"flex-1 py-3 border-2 border-black text-[10px] font-black uppercase tracking-widest hover:bg-neutral-100 transition-all",children:"Cancel"}),(0,t.jsx)("button",{onClick:async()=>{if(F&&P){k(!0);try{await (0,v.verifyHousingPaymentManually)(F,Number(P),T,"Manual verification by admin"),alert("Payment verified & recorded successfully"),window.location.reload()}catch(e){alert(e.message)}finally{k(!1)}}},disabled:_,className:"flex-1 py-3 bg-green-600 text-white text-[10px] font-black uppercase tracking-widest hover:bg-green-700 transition-all disabled:opacity-50",children:_?"Verifying...":"Confirm Payment"})]})]})})]})}function N(){let[e,c]=(0,a.useState)(!0),[o,d]=(0,a.useState)({invoices:[],payments:[],students:[]}),u=(0,r.useRouter)();return((0,a.useEffect)(()=>{(async()=>{let e=(0,n.createClient)(),{data:{user:t}}=await e.auth.getUser();if(!t)return u.push("/portal/account/login");let{data:a}=await e.from("profiles").select("role").eq("id",t.id).single();if(a?.role!=="ADMIN")return u.push("/portal/dashboard");let[r,l,s]=await Promise.all([e.from("housing_invoices").select("*, student:students(id, student_id, user:profiles(*)), items:housing_invoice_items(*)").order("created_at",{ascending:!1}),e.from("housing_payments").select("*, student:students(id, user:profiles(first_name, last_name)), invoice:housing_invoices(reference_number)").order("created_at",{ascending:!1}),e.from("students").select("*, user:profiles(first_name, last_name)").limit(100)]);d({invoices:r.data||[],payments:l.data||[],students:s.data||[]}),c(!1)})()},[u]),e)?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsx)(i.CircleNotch,{className:"animate-spin text-neutral-400",size:40,weight:"bold"})}):(0,t.jsx)("div",{className:"min-h-screen bg-neutral-50/50 p-4 md:p-8 font-sans",children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,t.jsx)("div",{className:"mb-6",children:(0,t.jsxs)(l.default,{href:"/admin/housing",className:"inline-flex items-center gap-2 text-[10px] font-black uppercase tracking-widest text-neutral-500 hover:text-black transition-colors",children:[(0,t.jsx)(s.CaretLeft,{size:14})," Back to Housing Management"]})}),(0,t.jsx)(y,{initialInvoices:o.invoices,initialPayments:o.payments,students:o.students})]})})}e.s(["default",()=>N],92947)}]);