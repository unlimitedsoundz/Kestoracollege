(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,9165,t=>{"use strict";var e=t.i(90615);async function a(t,a){let r=await (0,e.createClient)(),{data:{user:i}}=await r.auth.getUser();if(!i)throw Error("Unauthorized");let{data:s,error:o}=await r.from("admissions").select("*").eq("id",t).eq("user_id",i.id).single();if(o||!s)throw Error("Offer not found");if("PENDING"!==s.offer_status)throw Error("You have already submitted a response to this offer.");let d={offer_status:a};"ACCEPTED"===a&&(d.accepted_at=new Date().toISOString());let{error:n}=await r.from("admissions").update(d).eq("id",t);if(n)throw console.error("Error updating offer response:",n),Error(`Failed to save your decision: ${n.message}`);return"ACCEPTED"===a?await r.from("applications").update({status:"OFFER_ACCEPTED"}).eq("user_id",i.id).eq("status","ADMITTED"):await r.from("applications").update({status:"OFFER_DECLINED"}).eq("user_id",i.id).eq("status","ADMITTED"),{success:!0}}async function r(t){let a=await (0,e.createClient)(),{data:{user:r}}=await a.auth.getUser();if(!r)throw Error("Unauthorized");let{data:i,error:s}=await a.from("applications").select("id, user_id, status").eq("id",t).eq("user_id",r.id).single();if(s||!i)throw Error("Application not found");if("ADMITTED"!==i.status){if("OFFER_ACCEPTED"===i.status||"ENROLLED"===i.status||"DOCS_REQUIRED"===i.status)return{success:!0};throw Error("This application is not in a state to accept an offer.")}let{error:o}=await a.from("admission_offers").update({status:"ACCEPTED",accepted_at:new Date().toISOString()}).eq("application_id",t);if(o)throw console.error("Failed to update offer status:",o),Error("Failed to update offer status");let{error:d}=await a.from("applications").update({status:"OFFER_ACCEPTED",updated_at:new Date().toISOString()}).eq("id",t);if(d)throw console.error("Failed to update application status:",d),Error("Failed to update application status");try{let{data:e}=await a.from("applications").select("course(title)").eq("id",t).single(),i=e?.course?.title;i&&await a.from("admissions").update({offer_status:"ACCEPTED",accepted_at:new Date().toISOString()}).eq("user_id",r.id).eq("program",i)}catch(t){console.warn("Legacy admission update failed silently",t)}return{success:!0}}t.s(["acceptApplicationOffer",()=>r,"respondToOffer",()=>a])}]);