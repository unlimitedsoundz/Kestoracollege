(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,8145,e=>{"use strict";e.i(29225);var t=e.i(72390);function a(){return(0,t.createBrowserClient)("https://mrqzlmkdhzwvbpljikjz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1ycXpsbWtkaHp3dmJwbGppa2p6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1MTI5ODMsImV4cCI6MjA4NTA4ODk4M30.ILwXM7fhNnip6Mq5HF04poDCzdhcNO69AVnYmheSmeY")}e.s(["createAdminClient",()=>a])},93231,e=>{"use strict";var t=e.i(8145);async function a(a){let r=await (0,t.createAdminClient)();try{console.log("Enrollment: Starting for application",a);let{data:t,error:i}=await r.from("applications").select(`
                *,
                user:profiles!user_id(*),
                course:Course(*)
            `).eq("id",a).single();if(i||!t)return console.error("Enrollment: Application not found",i),{success:!1,error:"Application not found"};let o=t.user,s=new Date().getFullYear(),n=o.student_id;n||(n=`SK${s}${Math.floor(1e3+9e3*Math.random())}`);let l=`${o.first_name.toLowerCase()}.${o.last_name.toLowerCase()}@kestora.online`;l=l.replace(/\s+/g,"");let{data:c}=await r.from("students").select("institutional_email").eq("institutional_email",l).maybeSingle();c&&(l=`${o.first_name.toLowerCase()}.${o.last_name.toLowerCase()}${Math.floor(100*Math.random())}@kestora.online`.replace(/\s+/g,""));let{data:d,error:u}=await r.from("students").upsert({user_id:o.id,student_id:n,application_id:t.id,program_id:t.course_id,institutional_email:l,personal_email:o.email,enrollment_status:"ACTIVE",start_date:new Date().toISOString(),expected_graduation_date:new Date(new Date().setFullYear(new Date().getFullYear()+3)).toISOString()},{onConflict:"application_id"}).select().single();if(u)return console.error("Enrollment: Failed to create student record",u),{success:!1,error:`Failed to create student record: ${u.message}`};let{error:p}=await r.from("applications").update({status:"ENROLLED",admission_letter_generated:!0,receipt_generated:!0,updated_at:new Date().toISOString()}).eq("id",a);p&&console.warn("Enrollment: Success but failed to update application status",p),await r.from("profiles").update({role:"STUDENT",student_id:n}).eq("id",o.id);let{data:m}=await r.from("admission_offers").select("id").eq("application_id",a).maybeSingle();m&&await r.from("tuition_payments").update({status:"verified"}).eq("offer_id",m.id).eq("status","PENDING_VERIFICATION");try{let{generateAndStoreAdmissionLetter:t,generateAndStoreReceipt:r}=await e.A(69418);await t(a),await r(a)}catch(e){console.error("Enrollment: Post-action error",e)}return console.log("Enrollment: Success for",o.email),{success:!0,studentId:n}}catch(e){return console.error("Enrollment: Unexpected error",e),{success:!1,error:e.message}}}e.s(["enrollStudent",()=>a])},69418,e=>{e.v(t=>Promise.all(["static/chunks/905f96c32512582a.js"].map(t=>e.l(t))).then(()=>t(15357)))}]);